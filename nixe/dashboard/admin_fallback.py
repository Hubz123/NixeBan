# nixe/dashboard/admin_fallback.py\nimport os\nimport os\nfrom flask import Blueprint, request, session, redirect, url_for, render_template, render_template_string\n\nadmin_fallback_bp = Blueprint("admin_fallback", __name__)\n\ndef _get_creds():\n    user = os.getenv("ADMIN_USERNAME") or os.getenv("SUPER_ADMIN_USER")\n    pwd  = os.getenv("ADMIN_PASSWORD") or os.getenv("SUPER_ADMIN_PASS")\n    return (user or "").strip(), (pwd or "").strip()\n\n@admin_fallback_bp.route("/admin/login", methods=["GET", "POST"])\n@admin_fallback_bp.route("/login", methods=["GET", "POST"])\ndef admin_login():\n    want_user, want_pass = _get_creds()\n\n    # Kalau belum set kredensial admin di ENV, beritahu jelas\n    if not want_user or not want_pass:\n        return (\n            """<html><head><title>Login Admin</title></head>\n<body style="background:#0f1320;color:#e6e6e6;font-family:system-ui,Segoe UI,Arial,sans-serif;">\n  <div style="max-width:720px;margin:8vh auto;padding:24px;border-radius:16px;background:#161b2e;border:1px solid #28314f">\n    <h2 style="margin-top:0">Login Admin tidak aktif</h2>\n    <p>Set environment berikut:</p>\n    <pre style="background:#0b0f1a;padding:12px;border-radius:10px;white-space:pre-wrap;">ADMIN_USERNAME=admin\nADMIN_PASSWORD=your-strong-password</pre>\n    <p>Atau gunakan SUPER_ADMIN_USER / SUPER_ADMIN_PASS.</p>\n  </div>\n</body></html>""",\n            503,\n        )\n\n    message = None\n    if request.method == "POST":\n        u = (request.form.get("username") or "").strip()\n        p = (request.form.get("password") or "").strip()\n        if u == want_user and p == want_pass:\n            session["is_admin"] = True\n            session["admin_user"] = u\n            return redirect(url_for("admin_fallback.admin_home"))\n        message = "Username / password salah."\n\n    # Coba pakai template login.html kalau ada\n    try:\n        return render_template("login.html", message=message or "")\n    except Exception:\n        pass  # jatuh ke fallback inline\n\n    # Fallback inline login â€” gunakan format .format() yang aman (tanpa % / f-string)\n    bg = (os.getenv("DASHBOARD_BG_URL") or "").strip()\n    logo = (os.getenv("DASHBOARD_LOGO_URL") or "").strip()\n    bgstyle = "background-image:url('{0}');background-size:cover;background-position:center;".format(bg) if bg else ""\n    logo_tag = '<img class="logo" src="{0}" alt="logo">'.format(logo) if logo else ""\n    msg_html = '<div class="err">{0}</div>'.format(message) if message else ""\n\n    html = """<!doctype html><html><head>\n<meta charset="utf-8"><title>Login Admin</title>\n<style>\n  body {{ margin:0; background:#0f1320; color:#e6e6e6; font-family:system-ui,Segoe UI,Arial,sans-serif; {bgstyle} }}\n  .card {{ max-width:560px; margin:10vh auto; padding:28px; border-radius:16px; background:#161b2e; border:1px solid #28314f; box-shadow:0 10px 30px rgba(0,0,0,.35) }}\n  input,button {{ width:100%; padding:12px 14px; border-radius:10px; border:1px solid #334; outline:none; background:#0b0f1a; color:#e6e6e6; margin-top:10px }}\n  button {{ background:#3b82f6; border:0; cursor:pointer }}\n  .logo {{ display:block; margin:0 auto 12px auto; max-width:120px; border-radius:12px }}\n  .err {{ color:#ff8b8b; margin:8px 0 0 0 }}\n</style>\n</head><body>\n  <div class="card">\n    {logo_tag}\n    <h2 style="margin-top:0">Login Admin</h2>\n    {msg_html}\n    <form method="post" autocomplete="off">\n      <input name="username" placeholder="Username" required>\n      <input type="password" name="password" placeholder="Password" required>\n      <button type="submit">Login</button>\n    </form>\n  </div>\n</body></html>""".format(bgstyle=bgstyle, logo_tag=logo_tag, msg_html=msg_html)\n\n    return render_template_string(html)\n\n@admin_fallback_bp.route("/admin/logout", methods=["GET", "POST"])\ndef admin_logout():\n    session.clear()\n    return redirect(url_for("admin_fallback.admin_login"))\n\n@admin_fallback_bp.route("/admin")\ndef admin_home():\n    if not session.get("is_admin"):\n        return redirect(url_for("admin_fallback.admin_login"))\n    # render dashboard utama kalau ada; jika tidak, tampilkan stub sederhana\n    try:\n        return render_template("dashboard.html")\n    except Exception:\n        return "<h3>Admin dashboard</h3><p>Login berhasil.</p>", 200